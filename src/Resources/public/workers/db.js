!function(){"use strict";var e=function(){if(!(!navigator.userAgentData&&/Safari\//.test(navigator.userAgent)&&!/Chrom(e|ium)\//.test(navigator.userAgent))||!indexedDB.databases)return Promise.resolve();let e;return new Promise((t=>{const n=()=>indexedDB.databases().finally(t);e=setInterval(n,100),n()})).finally((()=>clearInterval(e)))};function t(e){return new Promise(((t,n)=>{e.oncomplete=e.onsuccess=()=>t(e.result),e.onabort=e.onerror=()=>n(e.error)}))}function n(n,r){const s=e().then((()=>{const e=indexedDB.open(n);return e.onupgradeneeded=()=>e.result.createObjectStore(r),t(e)}));return(e,t)=>s.then((n=>t(n.transaction(r,e).objectStore(r))))}let r;function s(){return r||(r=n("keyval-store","keyval")),r}function a(e,n){return e("readonly",(e=>(e.openCursor().onsuccess=function(){this.result&&(n(this.result),this.result.continue())},t(e.transaction))))}const o=n("easy_media_manager","media_manager");onmessage=e=>{let{type:n,key:r,val:c}=e.data;switch(n){case"get":(function(e,n=s()){return n("readonly",(n=>t(n.get(e))))})(r,o).then((e=>postMessage(e)));break;case"set":(function(e,n,r=s()){return r("readwrite",(r=>(r.put(n,e),t(r.transaction))))})(r,c,o).then((()=>postMessage(!0))).catch((()=>postMessage(!1)));break;case"del":(function(e,n=s()){return n("readwrite",(n=>(n.delete(e),t(n.transaction))))})(r,o).then((()=>postMessage(!0))).catch((()=>postMessage(!1)));break;case"clr":(function(e=s()){return e("readwrite",(e=>(e.clear(),t(e.transaction))))})(o).then((()=>postMessage(!0))).catch((()=>postMessage(!1)));break;case"keys":(function(e=s()){const t=[];return a(e,(e=>t.push(e.key))).then((()=>t))})(o).then((e=>postMessage(e))).catch((()=>postMessage(!1)))}}}();